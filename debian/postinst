#!/bin/sh

set -e

chmod 755 /usr/share/python-support/surfids-sensor/sensor/bin/sensor-manager.py
if [ -e "/etc/inittab" ]; then
    if [ ! -e "/etc/backup.inittab" ]; then
        mv -f /etc/inittab /etc/backup.inittab
        sed 's/.*tty1/1:2345:respawn:\/usr\/sbin\/sensor-manager <\/dev\/tty1 >\/dev\/tty1 2>\&1/' /etc/backup.inittab > /etc/inittab
    fi
fi
if [ -e "/etc/event.d/" ]; then
    mv -f /var/lib/surfids/tty1.conf /etc/event.d/tty1
else
    rm -f /var/lib/surfids/tty1.conf
fi

if [ -e "/etc/logrotate.d/" ]; then
    mv -f /var/lib/surfids/logrotate.conf /etc/logrotate.d/surfids-sensor
fi


# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

echo ""
if [ ! -e "/etc/surfids/ca.crt" ]; then
    echo "*) Add your tunnel server ca.crt to /etc/surfids/"
fi

# Handling main configuration file
if [ ! -e "/etc/surfids/surfids.conf" ]; then
    mv -f /etc/surfids/surfids.conf.dist /etc/surfids/surfids.conf
    echo "*) Configure /etc/surfids/surfids.conf"
fi

# Handling the openvpn configuration file
if [ ! -e "/etc/surfids/openvpn.conf" ]; then
    mv -f /etc/surfids/openvpn.conf.dist /etc/surfids/openvpn.conf
    echo "*) Configure /etc/surfids/openvpn.conf"
fi
echo "NOTE: If this is the first time you have installed surfids-sensor,"
echo "reboot your machine to startup the sensor environment!"
echo ""

exit 0
